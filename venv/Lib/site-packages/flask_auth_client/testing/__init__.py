import os
import jwt
import datetime

DATA_FOLDER = os.path.join(os.path.dirname(__file__), "data")
PUBLIC_KEY_PATH = os.path.join(DATA_FOLDER, "jwt-ec256-public.pem")
PRIVATE_KEY_PATH = os.path.join(DATA_FOLDER, "jwt-ec256-private.pem")


def get_public_key():
    with open(PUBLIC_KEY_PATH, "r") as f:
        return f.read()


def get_private_key():
    with open(PRIVATE_KEY_PATH, "r") as f:
        return f.read()


def generate_token(uid, role, expire=60, algorithm="ES256"):
    """Generate a token using the testing private key"""
    payload = {
        "uid": uid,
        "role": role,
        "exp": datetime.datetime.utcnow() + datetime.timedelta(minutes=expire),
    }
    private_key = get_private_key()
    token = jwt.encode(payload, private_key, algorithm=algorithm)
    return token
